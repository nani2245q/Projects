<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Dashboard — ShopAnalytics</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <nav class="navbar">
    <a href="/" class="logo">ShopAnalytics</a>
    <div class="nav-links">
      <a href="/">Products</a>
      <a href="/pages/cart.html">Cart</a>
      <a href="/pages/analytics.html" class="active">Analytics</a>
      <a href="/pages/login.html" id="auth-link">Login</a>
    </div>
  </nav>

  <div class="dash-container">
    <div class="page-header">
      <h1>Commerce Analytics Dashboard</h1>
      <p>Conversion funnel, revenue metrics, marketing attribution & customer cohorts</p>
    </div>

    <div id="login-prompt" class="hidden">
      <div class="alert alert-error">
        Please <a href="/pages/login.html">login as admin</a> to view analytics. (admin@ecommerce.com / admin123)
      </div>
    </div>

    <div id="dashboard-content">
      <!-- KPI Cards -->
      <div class="kpi-grid" id="kpi-grid"></div>

      <!-- Row 1: Funnel + Revenue side by side -->
      <div class="dash-row">
        <div class="chart-container">
          <h3>Checkout Conversion Funnel</h3>
          <p class="chart-subtitle">User journey from page view to purchase</p>
          <div class="funnel-chart" id="funnel-chart"></div>
          <p class="funnel-summary">
            Overall Conversion Rate: <span id="overall-conversion">—</span>
          </p>
        </div>

        <div class="chart-container">
          <h3>Revenue Over Time</h3>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline" onclick="loadRevenue('day')">Daily</button>
            <button class="btn btn-sm btn-outline" onclick="loadRevenue('week')">Weekly</button>
            <button class="btn btn-sm btn-outline" onclick="loadRevenue('month')">Monthly</button>
          </div>
          <canvas id="revenue-chart"></canvas>
        </div>
      </div>

      <!-- Row 2: Attribution Charts side by side -->
      <div class="chart-container">
        <h3>Marketing Attribution Report</h3>
        <p class="chart-subtitle">Revenue, sessions, and conversion rate by acquisition channel</p>
        <div class="dash-row dash-row-inner">
          <div><canvas id="attribution-revenue-chart"></canvas></div>
          <div><canvas id="attribution-conversion-chart"></canvas></div>
        </div>
        <table class="data-table" id="attribution-table">
          <thead>
            <tr>
              <th>Channel</th>
              <th>Sessions</th>
              <th>Orders</th>
              <th>Revenue</th>
              <th>AOV</th>
              <th>Conv. Rate</th>
              <th>Rev/Session</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Row 3: Category + Top Products side by side -->
      <div class="dash-row">
        <div class="chart-container">
          <h3>Category Performance</h3>
          <table class="data-table data-table-compact" id="category-table">
            <thead>
              <tr>
                <th>Category</th>
                <th>Views</th>
                <th>Cart</th>
                <th>Purchased</th>
                <th>View→Cart</th>
                <th>Revenue</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="chart-container">
          <h3>Top Products by Purchases</h3>
          <canvas id="top-products-chart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/config.js"></script>
  <script src="/js/analytics.js"></script>
</body>
</html>
