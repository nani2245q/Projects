<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Dashboard — ShopAnalytics</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <nav class="navbar">
    <a href="/" class="logo">ShopAnalytics</a>
    <div class="nav-links">
      <a href="/">Products</a>
      <a href="/pages/cart.html">Cart</a>
      <a href="/pages/analytics.html" class="active">Analytics</a>
      <a href="/pages/login.html" id="auth-link">Login</a>
    </div>
  </nav>

  <div class="container">
    <div class="page-header">
      <h1>Commerce Analytics Dashboard</h1>
      <p>Conversion funnel, revenue metrics, marketing attribution & customer cohorts</p>
    </div>

    <div id="login-prompt" class="hidden">
      <div class="alert alert-error">
        Please <a href="/pages/login.html">login as admin</a> to view analytics. (admin@ecommerce.com / admin123)
      </div>
    </div>

    <div id="dashboard-content">
      <!-- KPI Cards -->
      <div class="kpi-grid" id="kpi-grid"></div>

      <!-- Conversion Funnel -->
      <div class="chart-container">
        <h3>Checkout Conversion Funnel</h3>
        <p style="color: var(--gray-500); font-size: 0.85rem; margin-bottom: 1rem;">
          User journey from page view to purchase — drop-off rates shown in red
        </p>
        <div class="funnel-chart" id="funnel-chart"></div>
        <p style="margin-top: 1rem; font-weight: 600;">
          Overall Conversion Rate: <span id="overall-conversion" style="color: var(--primary);">—</span>
        </p>
      </div>

      <!-- Revenue Time Series -->
      <div class="chart-container">
        <h3>Revenue Over Time</h3>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <button class="btn btn-sm btn-outline" onclick="loadRevenue('day')">Daily</button>
          <button class="btn btn-sm btn-outline" onclick="loadRevenue('week')">Weekly</button>
          <button class="btn btn-sm btn-outline" onclick="loadRevenue('month')">Monthly</button>
        </div>
        <canvas id="revenue-chart" height="300"></canvas>
      </div>

      <!-- Marketing Attribution -->
      <div class="chart-container">
        <h3>Marketing Attribution Report</h3>
        <p style="color: var(--gray-500); font-size: 0.85rem; margin-bottom: 1rem;">
          Revenue, sessions, and conversion rate by acquisition channel
        </p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <canvas id="attribution-revenue-chart" height="250"></canvas>
          <canvas id="attribution-conversion-chart" height="250"></canvas>
        </div>
        <table class="data-table" style="margin-top: 1rem;" id="attribution-table">
          <thead>
            <tr>
              <th>Channel</th>
              <th>Sessions</th>
              <th>Orders</th>
              <th>Revenue</th>
              <th>AOV</th>
              <th>Conv. Rate</th>
              <th>Rev/Session</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Category Performance -->
      <div class="chart-container">
        <h3>Category Performance</h3>
        <table class="data-table" id="category-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Products</th>
              <th>Views</th>
              <th>Add to Cart</th>
              <th>Purchases</th>
              <th>View→Cart</th>
              <th>Cart→Purchase</th>
              <th>Revenue</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Top Products -->
      <div class="chart-container">
        <h3>Top Products by Purchases</h3>
        <canvas id="top-products-chart" height="250"></canvas>
      </div>
    </div>
  </div>

  <script src="/js/config.js"></script>
  <script src="/js/analytics.js"></script>
</body>
</html>
